Foodsoft
========

This role installs a multicoop [Foodsoft](https://foodcoops.net) instance at a Debian based system.
It uses [rbenv](https://github.com/rbenv/rbenv) to install all necessary Ruby and Rails packages.

A MariaDB server need to be installed separately.

All The Foodsoft components are started via Systemd services. Puma is used as an application server.
[Socket activation](https://github.com/puma/puma/blob/master/docs/systemd.md) is enabled.

## Variables

You can adapt the role to your need via the following variables. Please note: If there's no default you have to set this variable by yourself (e.g. via you playbook).

| Name | Default | Note |
|--|--|--|
| `foodsoft_home` | `/opt/foodsoft` | Path to install the Foodsoft instance |
| `foodsoft_user` | `_foodsoft` | System user that runs all services |
| `foodsoft_user_home` | `/var/lib/{{ foodsoft_user }}` | Home directory for the system user |
| `foodsoft_db` | `foodsoft` | Name of the Foodsoft database |
| `foodsoft_db_user` | `foodsoft` | Name of the Foodsoft database user |
| `foodsoft_db_password` | | Database password |
| `foodsoft_environment_file` | `/etc/foodsoft/foodsoft.conf` | Foodsoft configuration file used by systemd service |
| `doodsoft_web_service` | `foodsoft-web.service` | Name of the Foodsoft systemd web service |
| `foodsoft_web_socket` | `foodsoft-web.socket` | Name of the Foodsoft systemd web socket |
| `foodsoft_secret_key_base` | autogenerated | Foodsoft Rails secret key base |
| `foodsoft_smtp_service` | `foodsoft-smtp.service` | Name of the Foodsoft systemd SMTP service |
| `foodsoft_resque_service` | `foodsoft-resque.service` | Name of Foodsoft systemd [Resque](https://github.com/resque/resque) service |
| `foodsoft_web_bind_ip` | `127.0.0.1` | Listen address for the internal Foodsoft application server |
| `foodsoft_web_port` | `3001` | Liste port for the internal Foodsoft application server |
| `foodsoft_redis_url` | `redis://127.0.0.1:6379` | Redis connection |
| `foodsoft_version` | `master` | Foodsoft version to install |
| `ruby_build_version` | `master` | Ruby build version to install |
| `ruby_path` | `{{ foodsoft_user_home }}/.rbenv` | Path to Ruby binaries |
| `puma_port` | `9294` | Listen port for the internal Foodsoft application server |
| `mariadb_socket` | `/run/mysqld/mysqld.sock` | MariaDB connection socket |

### Configuration of mail delivery

For outgoing mail delivery the Foodsoft needs to connect to an SMTP server.

| Name | Default | Note |
|--|--|--|
| `foodsoft_smtp_address` | `127.0.0.1` | Address of the SMTP server |
| `foodsoft_smtp_port` | `25` | Port of the SMTP server |
| `foodsoft_smtp_authentication` | `false` | `True` if your SMTP server requires authentication |
| `foodsoft_smtp_enable_starttls_auto` | `false` | `True` if your SMTP server only accepts TLS connections |
| `foodsoft_smtp_user_name` | `nil` | SMTP user name |
| `foodsoft_smtp_password` | `nil` | SMTP password |
| `foodsoft_smtp_domain` | `nil` | Sender domain |
| `foodsoft_smtp_openssl_verify_mode` | `nil` | Set for certificate verification |

### Configuration for incomming mail processing

The Foodsoft provides an internal SMTP server that processes incomming mails.

| Name | Default | Note |
|--|--|--|
| `foodsoft_smtp_server_host` | `127.0.0.1` | Listen address for the internal Foodsoft SMTP server |
| `foodsoft_smtp_server_port` | `2526` | Listen port for the internal Foodsoft SMTP server |

### Connect to Sharedlists database

It's possbile to access the [Sharedlists][https://github.com/foodcoops/sharedlists] database
from within the Foodsoft. Just use the following variables to grant the Foodsoft database user
`SELECT` access to the Sharedlists database.

| Name | Default | Note |
|--|--|--|
| `sharedlists.enabled` | `False` | `True` if you want to connect a Sharedlists database |
| `sharedlists.database` | `nil` | Name of the sharedlists database |
